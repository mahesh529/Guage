<!DOCTYPE html>
<html>
<body>
<canvas id="meter0" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>


<canvas id="meter1" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter2" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter3" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter4" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter5" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter6" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter7" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter8" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter9" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter10" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter11" data-min="0" data-max="400" data-endpoints="10,20,40,100,480" data-endpointsdisp='1,2,4,10,18' data-num='200' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter12" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>


<canvas id="meter13" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter14" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>


<canvas id="meter15" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter16" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>


<canvas id="meter17" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter18" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<canvas id="meter19" data-min="0" data-max="300" data-endpoints="0,50,70,100,380" data-endpointsdisp='0,5,7,10,18' data-num='100' data-asc='true'  data-colors="red,orange,blue,yellow"  class="meter"></canvas>

<script>

    var colorsd = ["#059669", "#FF7F00", "#F00", "#A71E0B"];
    var fiveDegree = Math.PI / 180 * 5, lastAngle = 0;;
    //var adder = Math.PI / 180 * 20;
    var maxPoint = 120;
    function compareNumbers(a, b) {
        return a - b;
    }
    Array.max = function( array ){
    return Math.max.apply( Math, array );
};
Array.min = function( array ){
    return Math.min.apply( Math, array );
};
    var gauge = function (options, canvas, context) {
        context.clearRect(0, 0, canvas.width, canvas.height);
        var that = {};
        var minValue = options.minValue, maxValue = options.maxValue;

        var EndPoints = options.endPoints;//[20, 50, 100];
        var Colors = options.sectionColors;//["red", "blue", 'green'];
        var Pointer = options.pointer;


        function drawMeter(Pointer, minValue, maxValue, EndPoints, Colors) {
            //context.clearRect(0, 0, canvas.width, canvas.height);
           
            function getAngle(EndPoint) {
                var point = 180 / (maxValue - minValue);
                var angle = options.isAsc?(EndPoint-minValue)*point:(maxValue - EndPoint) * point;
                //angle = (180 - angle) * Math.PI / 180;
                angle = 1 * Math.PI + angle * Math.PI / 180;
                return angle;
            };
            
            var x = canvas.width / 2, y = canvas.height - 7;
            var startAngle = 1 * Math.PI, tempangle = startAngle, endAngle = startAngle;
            //whole circle
          
            context.font = '7pt Arial';
            context.textAlign = 'center';
            context.fillStyle = 'black';
            context.strokeStyle = 'black';
            context.lineWidth = 30;
            var tx1, tx2;
            //console.log(Colors, EndPoints);
            for (var i = 0; i < EndPoints.length; i++) {
                endAngle = getAngle(EndPoints[i]);
                //outer circle    

                tx1 = x + 56 * Math.cos(endAngle)
                tx2 = y + 56 * Math.sin(endAngle)

                context.beginPath();


                context.textAlign = endAngle < 4.72 ? "end" : 'start';
                context.textAlign = endAngle > 4.7 && endAngle < 4.72 ? 'center' : context.textAlign;
                if (endAngle - lastAngle > fiveDegree) {//to avoid collision b/w two close values
                    context.fillText(options.endpointsdisp[i], tx1, tx2);
                    lastAngle = endAngle;
                }
                if (i > 0) {
                    context.arc(x, y, 40, startAngle, endAngle, false);
                    context.strokeStyle = Colors[i - 1];
                }
                context.stroke();
                //alert(EndPoints[i])
                startAngle = endAngle;


            }

            context.textAlign = "end";
            //context.fillText(minValue, x - 56, y);





            var poitteangle = getAngle(Pointer);

            a = x + 56 * Math.cos(poitteangle)
            b = y + 56 * Math.sin(poitteangle)



            var smallrad = 5, percAngle = 150;
            context.beginPath();
            context.moveTo(x, y);
            context.lineWidth = 0;
            context.lineTo(x + smallrad * Math.cos(poitteangle - percAngle), y + smallrad * Math.sin(poitteangle - percAngle))
            context.lineTo(a, b);
            // context.fillStyle = 'white';
            context.lineTo(x + smallrad * Math.cos(poitteangle + percAngle), y + smallrad * Math.sin(poitteangle + percAngle))
            context.fill();


        }

        drawMeter(Pointer, minValue, Array.max(EndPoints), EndPoints, Colors)
    }

    var meters = new Array(), meterAnimId = new Array();

    var requestAnimationFrame = window.requestAnimationFrame ||
                                window.mozRequestAnimationFrame ||
                                window.webkitRequestAnimationFrame ||
                                window.msRequestAnimationFrame;

    //  var cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame;

    function Meter(id, minValue, maxValue, EndPoints,EndPointsDisp, sectionColors, pointer,isAsc) {
        this.isAsc = isAsc;
        this.id = id;
        this.minValue = minValue;
        this.maxValue = maxValue;
        this.endPoints = isAsc ? EndPoints.sort(compareNumbers) : EndPoints.sort(compareNumbers).reverse();
        this.endpointsdisp = isAsc ? EndPointsDisp : EndPointsDisp.reverse();
        this.sectionColors = isAsc ? sectionColors:sectionColors.reverse();
        this.pointer =isAsc?minValue:maxValue;
        this.val = pointer;
        this.isValReached = false;
        this.adder = (Array.max(EndPoints) - minValue) / 180;
        //console.log(this.adder);
    }

    Meter.prototype.update = function () {

        var mainCanvas = document.getElementById(this.id);
        if (mainCanvas != null) {
            var mainContext = mainCanvas.getContext('2d');
            if (window.requestAnimationFrame) {
                if (!this.isValReached) {

                    if (this.isAsc) {
                        this.pointer += this.adder;
                        this.isValReached = this.pointer >= this.val;
                    } else {
                        this.pointer -= this.adder;
                        this.isValReached = this.pointer <= this.val;
                    }
                    gauge(this, mainCanvas, mainContext);


                }
            } else {
                this.stop();
            }
        }
    };
    Meter.prototype.stop = function () {

        var mainCanvas = document.getElementById(this.id);
        if (mainCanvas != null) {
            var mainContext = mainCanvas.getContext('2d');
            mainContext.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
            this.pointer = this.val;
            gauge(this, mainCanvas, mainContext);
            lastAngle = 0;
        }
    }
    function drawMeters() {
     
       if (document.querySelectorAll){
    var clsElements = document.querySelectorAll(".meter");
    for (var i = 0; i < clsElements.length; i++) {
          

             var $this=clsElements[i],
             id = $this.getAttribute('id'),
            minValue = $this.dataset.min,
            maxValue = $this.dataset.max,
            EndPoints =$this.dataset.endpoints.split(','),
            EndPointsDisp=$this.dataset.endpointsdisp.split(','),
            sectionColors =$this.dataset.colors.split(','),
            pointer =$this.dataset.num,isAsc=$this.dataset.asc=="True"?true:false;

            var meter = new Meter(id, minValue, maxValue, EndPoints,EndPointsDisp, sectionColors, pointer,isAsc);
            meters.push(meter);
     
    }
     draw();
}
    
       
    }


    function draw() {
        // console.log($('.MeterGauge').length)
        for (var i = 0; i < meters.length; i++) {
            var myMeter = meters[i];
            if (!myMeter.isValReached) {
                myMeter.update();
            } else {
                myMeter.stop();
            }
        }
        if (window.requestAnimationFrame) {
            requestAnimationFrame(draw);
        }
    }
   window.onload=drawMeters;
    </script>
    </body>
    </html>